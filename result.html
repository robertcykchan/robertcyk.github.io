<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ä¹å‹äººæ ¼æµ‹è¯•ç»“æœ</title>
    <style>
        body {font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 30px; line-height: 1.8}
        .result-section {margin: 40px 0; padding: 25px; background: #f8f9fa; border-radius: 8px}
        .chart-container {width: 600px; height: 400px; margin: 30px auto}
        h3 {color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px}
        .type-grid {display: grid; grid-template-columns: repeat(3,1fr); gap: 20px}
        .type-card {padding: 15px; border: 1px solid #dee2e6; border-radius: 5px}
    </style>
</head>
<body>
    <h1 style="text-align: center; color: #2c3e50">ä¹å‹äººæ ¼æµ‹è¯•æŠ¥å‘Š</h1>
    
    <div class="result-section">
        <h3>ğŸ”® æ ¸å¿ƒåˆ†æ</h3>
        <div id="mainResult"></div>
        <div id="wingResult"></div>
        <div id="tritypeResult"></div>
        <div id="subtypeResult"></div>
    </div>

    <div class="result-section">
        <h3>ğŸ“Š å¾—åˆ†åˆ†å¸ƒ</h3>
        <div class="chart-container">
            <canvas id="radarChart"></canvas>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ç±»å‹æ˜ å°„é…ç½®ï¼ˆæ¯ä¸ªé—®é¢˜å¯¹åº”å…·ä½“ç±»å‹ï¼‰
        const questionTypeMap = {
            /* è„‘åŒºï¼ˆ5/6/7ï¼‰*/
            1:5, 8:6, 15:7, 22:5, 29:6, 36:7, 43:5,
            /* å¿ƒåŒºï¼ˆ2/3/4ï¼‰*/
            2:2, 9:3, 16:4, 23:2, 30:3, 37:4, 44:2,
            /* è…¹åŒºï¼ˆ8/9/1ï¼‰*/
            3:8, 10:9, 17:1, 24:8, 31:9, 38:1, 45:8,
            /* ç»§ç»­è¡¥å……å‰©ä½™é—®é¢˜*/
            4:5, 11:6, 18:7, 25:5, 32:6, 39:7, 46:5,
            5:2, 12:3, 19:4, 26:2, 33:3, 40:4, 47:2,
            6:8, 13:9, 20:1, 27:8, 34:9, 41:1, 48:8,
            7:5, 14:6, 21:7, 28:5, 35:6, 42:7, 49:5
        };

        // åˆå§‹åŒ–å¾—åˆ†å¯¹è±¡
        let scores = {
            1:0, 2:0, 3:0, 4:0, 5:0, 6:0, 7:0, 8:0, 9:0
        };

        // ä»localStorageåŠ è½½æ•°æ®
        function loadAnswers() {
            for(let i=1; i<=49; i++) {
                const answer = parseInt(localStorage.getItem(`q${i}`)) || 0;
                const type = questionTypeMap[i];
                scores[type] += answer;  // ç›´æ¥ç´¯åŠ åˆ°å¯¹åº”ç±»å‹
            }
        }

        // è·å–ä¸»å‹
        function getCoreType() {
            return Object.entries(scores).sort((a,b) => b[1]-a[1])[0];
        }

        // è·å–ä¾§ç¿¼
        function getWing(coreType) {
            const wingMap = {
                1: [9,2], 2: [1,3], 3: [2,4], 4: [3,5], 
                5: [4,6], 6: [5,7], 7: [6,8], 8: [7,9], 9: [8,1]
            };
            const wings = wingMap[coreType[0]];
            return scores[wings[0]] > scores[wings[1]] ? wings[0] : wings[1];
        }

        // è·å–Tritype
        function getTritype() {
            const centers = {
                head: [5,6,7],
                heart: [2,3,4],
                gut: [8,9,1]
            };

            const getCenterMax = (types) => {
                let maxType = types[0];
                types.forEach(t => {
                    if(scores[t] > scores[maxType]) maxType = t;
                });
                return maxType;
            };

            const components = [
                getCenterMax(centers.head),
                getCenterMax(centers.heart),
                getCenterMax(centers.gut)
            ];

            // æ£€æŸ¥é‡å¤
            const unique = new Set(components);
            if(unique.size === 3) {
                return components.sort().join('');
            }

            // å¤„ç†é‡å¤æƒ…å†µ
            const backupSelect = (centerTypes) => {
                const sorted = [...centerTypes].sort((a,b) => scores[b]-scores[a]);
                for(let t of sorted) {
                    if(!components.includes(t)) return t;
                }
                return sorted[0];
            };

            return [
                backupSelect(centers.head),
                backupSelect(centers.heart),
                backupSelect(centers.gut)
            ].sort().join('');
        }

        // è·å–å‰¯å‹ï¼ˆç¤ºä¾‹ç®€åŒ–ç‰ˆï¼‰
        function getSubtype() {
            const subtypeScores = {
                selfPreservation: [21,28,35,42,49].reduce((acc, q) => acc + (parseInt(localStorage.getItem(`q${q}`)) || 0), 0),
                social: [20,27,34,41,48].reduce((acc, q) => acc + (parseInt(localStorage.getItem(`q${q}`)) || 0), 0),
                sexual: [19,26,33,40,47].reduce((acc, q) => acc + (parseInt(localStorage.getItem(`q${q}`)) || 0), 0)
            };
            return Object.entries(subtypeScores).sort((a,b) => b[1]-a[1])[0][0];
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults() {
            const [coreType, coreScore] = getCoreType();
            const wing = getWing([coreType, coreScore]);
            const tritype = getTritype();
            const subtype = getSubtype();

            document.getElementById('mainResult').innerHTML = `
                <p><strong>ä¸»å‹ï¼š</strong>${coreType}å‹ (å¾—åˆ†ï¼š${coreScore})</p>`;
            document.getElementById('wingResult').innerHTML = `
                <p><strong>ä¾§ç¿¼ï¼š</strong>${coreType}w${wing}</p>`;
            document.getElementById('tritypeResult').innerHTML = `
                <p><strong>Tritypeï¼š</strong>${tritype}</p>`;
            document.getElementById('subtypeResult').innerHTML = `
                <p><strong>å‰¯å‹ï¼š</strong>${subtype.replace(/([A-Z])/g, ' $1').trim()}</p>`;
        }

        // ç»˜åˆ¶é›·è¾¾å›¾
        function drawChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['1å‹', '2å‹', '3å‹', '4å‹', '5å‹', '6å‹', '7å‹', '8å‹', '9å‹'],
                    datasets: [{
                        label: 'ç±»å‹å¾—åˆ†',
                        data: [scores[1], scores[2], scores[3], scores[4],
                               scores[5], scores[6], scores[7], scores[8], scores[9]],
                        backgroundColor: 'rgba(0,123,255,0.2)',
                        borderColor: '#007bff'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            min: 0,
                            max: Math.max(...Object.values(scores)) + 5
                        }
                    }
                }
            });
        }

        // åˆå§‹åŒ–
        function init() {
            loadAnswers();
            displayResults();
            drawChart();
        }
        
        init();
    </script>
</body>
</html>